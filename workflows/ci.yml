name: CI

on:
  pull_request:
    branches:
      -'*'

jobs:
  build:
    runs-on: ubuntu-latest
  steps:
  - name: Checkout Repository
    uses: actions/checkout@v2

  - name: Setup Node.js
    uses: actions/set-upnode@v3
    with:
     node-version:14

  - name: Install Dependencies
    run: npm install
  - name: Lint
    run: npm run lint
  - name: Prettier
    run: npm run prettier
  - name: Test
    run: CI= true npn run test

  - name: build
    run: npm run build

deploy:
  runs-on: ubuntu-latest

  needs: build

  steps:
  - name: Apply Kubernetes Secret
    run: kubectl apply -f k8/secret.yml
  - name: Apply Kubernetes Service
    run: kubectl apply -f k8/secret.yml
  - name: Apply Kubernetes Deployment
    run: kubectl apply -f k8/secret.yml
  - name: Apply Kubernetes Ingress
    run: kubectl apply -f k8/secret.yml